# Cisco Tetration - Hands-On Lab

## Module19: Policy Analysis - NopCommerce

---


This diagram is an important one because it depicts the flow that is both specific to, and critical for Microsoft server applications. Microsoft uses a range of 16,383 ports for a technology known as "RPC" or "Remote Procedure Calls". Specifically, they use TCP ports 49195-65535.  While RPC is not a Microsoft protocol and not unique to only Microsoft workloads, it is most commonly found in environments that have Windows servers. In fact, it could easily be said that almost _every_ data center and cloud environment that has Windows server workloads will almost certainly be utilitizing their version of RPC - namely MSRPC. Since the destination port for RPC is dynamically chosen at execution time, and because that port can fall anywhere in the above mentioned range, it is critical that policy generated by Tetration includes these destination port ranges for virtually any Windows server that needs to communicate with an Active Directory Domain Controller using Windows Server domains protocols - such as authentication. While not every server necessarily needs to authenticate often, when necessary it is critical that it be allowed to do so. We want to ensure that these AD servers have policy instantiated that allow other windows servers (and workstation clients) to communicate with them on these ports.

In our case, we have the MS-SQL server set to use Domain Authentication rather than the built-in SA (System Account) user, which we have seen time and again in corporate environments, because it allows DBAs and domain admins to easily update passwords in a central location that databases distributed across the organization all use, rather than reaching out to every SQL server and updating the local SA account password when necessary (say in the event that a DBA moves on from the org).

Another common place you may find RPC in use is with NFS. You will likely encounter the usage of RPC in many other environments and should be on the lookout for it and other ephemeral port-range protocols like it. A quick parting thought is that you should look out for other ephemeral port "hopping" protocols besides RPC, when building policy in a production deployment of Tetration. A quick example that comes to mind is "RTP" or "Real Time Protocol". RTP and its sister - RTCP (Real Time Control Protocol) together use a range of UCP ports from 16384-32767, and will likely be found anywhere that VoIP is used - such as with IP Phones and Telepresence units talking to one another as well as a slew of other devices such as voice gateways and call recorders.

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/diagrams/images/diagrams_009.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/diagrams/images/diagrams_009.png" style="width:100%;height:100%;"></a>  


---


<a href="https://cisco-tetration-hol-content.s3.amazonaws.com/videos/19_policy_analysis_nopcommerce.mp4" style="font-weight:bold" title="Policy Analysis - nopCommerce Policies"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/diagrams/images/video_icon_mini.png"> Click here to view a video of the tasks necessary to perform policy analysis for the nopCommerce app.</a>

---


### Steps for this Module  
<a href="#step-001" style="font-weight:bold">Step 001</a>  
<a href="#step-002" style="font-weight:bold">Step 002</a>  
<a href="#step-003" style="font-weight:bold">Step 003</a>  
<a href="#step-004" style="font-weight:bold">Step 004</a>  
<a href="#step-005" style="font-weight:bold">Step 005</a>  
<a href="#step-006" style="font-weight:bold">Step 006</a>  
<a href="#step-007" style="font-weight:bold">Step 007</a>  
<a href="#step-008" style="font-weight:bold">Step 008</a>  
<a href="#step-009" style="font-weight:bold">Step 009</a>  
<a href="#step-010" style="font-weight:bold">Step 010</a>  
<a href="#step-011" style="font-weight:bold">Step 011</a>  
<a href="#step-012" style="font-weight:bold">Step 012</a>  
<a href="#step-013" style="font-weight:bold">Step 013</a>  
<a href="#step-014" style="font-weight:bold">Step 014</a>  
<a href="#step-015" style="font-weight:bold">Step 015</a>  
<a href="#step-016" style="font-weight:bold">Step 016</a>  
<a href="#step-017" style="font-weight:bold">Step 017</a>  
<a href="#step-018" style="font-weight:bold">Step 018</a>  
<a href="#step-019" style="font-weight:bold">Step 019</a>  
<a href="#step-020" style="font-weight:bold">Step 020</a>  
<a href="#step-021" style="font-weight:bold">Step 021</a>  

---

<div class="step" id="step-001"><a href="#step-001" style="font-weight:bold">Step 001</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_001.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_001.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-002"><a href="#step-002" style="font-weight:bold">Step 002</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_002.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_002.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-003"><a href="#step-003" style="font-weight:bold">Step 003</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_003.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_003.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-004"><a href="#step-004" style="font-weight:bold">Step 004</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_004.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_004.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-005"><a href="#step-005" style="font-weight:bold">Step 005</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_005.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_005.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-006"><a href="#step-006" style="font-weight:bold">Step 006</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_006.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_006.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-007"><a href="#step-007" style="font-weight:bold">Step 007</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_007.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_007.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-008"><a href="#step-008" style="font-weight:bold">Step 008</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_008.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_008.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-009"><a href="#step-009" style="font-weight:bold">Step 009</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_009.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_009.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-010"><a href="#step-010" style="font-weight:bold">Step 010</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_010.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_010.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-011"><a href="#step-011" style="font-weight:bold">Step 011</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_011.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_011.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-012"><a href="#step-012" style="font-weight:bold">Step 012</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_012.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_012.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-013"><a href="#step-013" style="font-weight:bold">Step 013</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_013.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_013.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-014"><a href="#step-014" style="font-weight:bold">Step 014</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_014.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_014.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-015"><a href="#step-015" style="font-weight:bold">Step 015</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_015.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_015.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-016"><a href="#step-016" style="font-weight:bold">Step 016</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_016.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_016.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-017"><a href="#step-017" style="font-weight:bold">Step 017</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_017.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_017.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-018"><a href="#step-018" style="font-weight:bold">Step 018</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_018.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_018.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-019"><a href="#step-019" style="font-weight:bold">Step 019</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_019.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_019.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-020"><a href="#step-020" style="font-weight:bold">Step 020</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_020.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_020.png" style="width:100%;height:100%;"></a>  



<div class="step" id="step-021"><a href="#step-021" style="font-weight:bold">Step 021</a></div>  

<a href="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_021.png"><img src="https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/images/module19_021.png" style="width:100%;height:100%;"></a>  





| [Return to Table of Contents](https://onstakinc.github.io/cisco-tetration-hol/labguide/) | [Go to Top of the Page](https://onstakinc.github.io/cisco-tetration-hol/labguide/module19/) | [Continue to the Next Module](https://onstakinc.github.io/cisco-tetration-hol/labguide/module20/) |
